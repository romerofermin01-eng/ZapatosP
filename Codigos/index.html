<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Nike Store</title>

<!-- jsPDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{
margin:0;
font-family:Arial;
background:#f2f2f2;
}

header{
background:black;
color:white;
padding:20px;
display:flex;
justify-content:space-between;
align-items:center;
}

.carrito{
background:white;
color:black;
padding:10px 15px;
border-radius:20px;
font-weight:bold;
}

.contenedor{
display:flex;
justify-content:center;
gap:25px;
flex-wrap:wrap;
padding:40px;
}

.producto{
background:white;
width:270px;
border-radius:15px;
overflow:hidden;
box-shadow:0 5px 15px rgba(0,0,0,0.2);
}

.producto img{
width:100%;
height:220px;
object-fit:cover;
}

.info{
padding:15px;
text-align:center;
}

select{
width:100%;
padding:8px;
margin-bottom:10px;
}

button{
width:100%;
padding:10px;
border:none;
background:black;
color:white;
border-radius:8px;
cursor:pointer;
}

.whatsapp{
position:fixed;
bottom:20px;
right:20px;
background:#25D366;
color:white;
padding:15px 20px;
border:none;
border-radius:50px;
font-size:16px;
cursor:pointer;
}
</style>
</head>

<body>

<header>
<div>NIKE STORE</div>
<div class="carrito">ðŸ›’ <span id="contador">0</span></div>
</header>

<div class="contenedor">

<!-- PRODUCTO 1 -->
<div class="producto">
<img src="img/Z1.jpeg">
<div class="info">
<h3>Nike Air Runner</h3>
<p>$799 MXN</p>

<select id="t1">
<option value="">Selecciona talla</option>
<option>25</option>
<option>26</option>
<option>27</option>
<option>28</option>
<option>29</option>
</select>

<button onclick="agregar('Nike Air Runner',799,'img/Z1.jpg','t1')">
Agregar
</button>
</div>
</div>

<!-- PRODUCTO 2 -->
<div class="producto">
<img src="img/Z2.jpeg">
<div class="info">
<h3>Nike Street Pro</h3>
<p>$899 MXN</p>

<select id="t2">
<option value="">Selecciona talla</option>
<option>25</option>
<option>26</option>
<option>27</option>
<option>28</option>
<option>29</option>
</select>

<button onclick="agregar('Nike Street Pro',899,'img/Z2.jpg','t2')">
Agregar
</button>
</div>
</div>

<!-- PRODUCTO 3 -->
<div class="producto">
<img src="img/Z3.jpeg">
<div class="info">
<h3>Nike Street Pro</h3>
<p>$899 MXN</p>

<select id="t3">
<option value="">Selecciona talla</option>
<option>25</option>
<option>26</option>
<option>27</option>
<option>28</option>
<option>29</option>
</select>

<button onclick="agregar('Nike Street Pro',899,'img/Z3.jpg','t3')">
Agregar
</button>
</div>
</div>

</div>

<button class="whatsapp" onclick="procesarPedido()">
Generar PDF y Enviar WhatsApp
</button>

<script>

let carrito=[];

// AGREGAR PRODUCTO
function agregar(nombre,precio,img,idTalla){

let talla=document.getElementById(idTalla).value;

if(!talla){
alert("Selecciona una talla");
return;
}

carrito.push({nombre,precio,img,talla});
document.getElementById("contador").innerText=carrito.length;

console.log("Carrito:", carrito);
}

// GENERAR PDF + WHATSAPP
async function procesarPedido(){

if(carrito.length===0){
alert("Carrito vacÃ­o");
return;
}

const { jsPDF } = window.jspdf;
const doc = new jsPDF();

doc.setFontSize(18);
doc.text("PEDIDO NIKE STORE",20,20);

let y=40;
let total=0;

for(let item of carrito){

doc.setFontSize(12);
doc.text(`Producto: ${item.nombre}`,20,y); y+=7;
doc.text(`Talla: ${item.talla}`,20,y); y+=7;
doc.text(`Precio: $${item.precio} MXN`,20,y); y+=10;

total+=item.precio;

// INTENTAR CARGAR IMAGEN
try{
let imgData=await convertirBase64(item.img);
doc.addImage(imgData,'JPEG',20,y,50,40);
}catch(error){
console.error("Error imagen:", item.img);
doc.text("(Imagen no disponible)",20,y);
}

y+=50;

if(y>250){
doc.addPage();
y=20;
}
}

doc.text(`TOTAL: $${total} MXN`,20,y);

// GUARDAR PDF
doc.save("Pedido_Nike.pdf");

// WHATSAPP (SIEMPRE SE EJECUTA)
let mensaje="Hola, quiero realizar este pedido:%0A%0A";

carrito.forEach((item,i)=>{
mensaje += `${i+1}. ${item.nombre}%0A`;
mensaje += `Talla: ${item.talla}%0A`;
mensaje += `Precio: $${item.precio} MXN%0A%0A`;
});

mensaje += `TOTAL: $${total} MXN`;

console.log("Enviando a WhatsApp...");

setTimeout(()=>{
window.open(`https://wa.me/5217531186614?text=${mensaje}`,"_blank");
},500);

}

// CONVERTIR IMAGEN (MEJORADO)
function convertirBase64(url){
return new Promise((resolve,reject)=>{

let img=new Image();
img.crossOrigin="anonymous";

img.onload=function(){
try{
let canvas=document.createElement("canvas");
canvas.width=img.width;
canvas.height=img.height;
let ctx=canvas.getContext("2d");
ctx.drawImage(img,0,0);
resolve(canvas.toDataURL("image/jpeg"));
}catch(e){
reject(e);
}
}

img.onerror=function(){
reject("No carga imagen");
}

img.src=url;

});
}

</script>

</body>
</html>




